# OpenShift-specific values for ospo-app
# This file contains OpenShift-optimized configurations

# OpenShift configuration
openshift:
  enabled: true
  domain: "apps.ospo-osci.z3b1.p1.openshiftapps.com"  # OpenShift cluster domain
  routes:
    enabled: true
    host: ""  # Will be auto-generated by OpenShift
    tls:
      enabled: true
      termination: edge
  securityContext:
    # Pod-level security context for OpenShift - only pod-level fields
    runAsUser: null
    runAsGroup: null
    fsGroup: null

# Otterize Security (Intent-based Access Control)
otterize:
  enabled: false  # Temporarily disabled to ensure clean deployment
  credentials:
    clientId: "cli_2qzdt2865q"
    clientSecret: "838e61fc0fa3c3af9b6686232ef9f0fdaf42890e5afdce1ec34d7381a8823223"
  config:
    mode: "defaultShadow"  # Options: defaultShadow, defaultDeny, defaultAllow
    certificateProvider: "otterize-cloud"
  intents:
    # Define network intents for OSPO components
    # Temporarily disabled - will be enabled after Otterize CRDs are confirmed
    enabled: false
    policies:
      - name: "ospo-app-to-postgres"
        from: "ospo-app"
        to: "postgres"
        ports: [5432]
      - name: "ospo-app-to-keycloak"
        from: "ospo-app"
        to: "keycloak"
        ports: [8080]
      - name: "ospo-app-to-minio"
        from: "ospo-app"
        to: "minio"
        ports: [9000]
      - name: "keycloak-to-postgres"
        from: "keycloak"
        to: "postgres"
        ports: [5432]

# Application configuration
app:
  baseUrl: "https://ospo-events-ospo-app-prod-rh-events-org.apps.ospo-osci.z3b1.p1.openshiftapps.com"
  image:
    repository: image-registry.openshift-image-registry.svc:5000/prod-rh-events-org/ospo-events-app
    tag: latest
    pullPolicy: Always  # Use Always for development
  service:
    type: ClusterIP
    port: 4576
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi
  # Pod-level security context
  securityContext:
    runAsUser: null
    runAsGroup: null
    fsGroup: null
  # Container-level security context
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL
    runAsNonRoot: true
  env:
    NODE_ENV: production
    PORT: "4576"
    SESSION_SECRET: "ospo-session-secret-production-change-me"
    SESSION_STORE_TYPE: "memory"
    VITE_SERVE_CLIENT: "true"
    KEYCLOAK_CLIENT_ID: "ospo-events-app"
    KEYCLOAK_CLIENT_SECRET: "ospo-client-secret-change-me"

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: 16-alpine
    pullPolicy: IfNotPresent
  auth:
    username: ospo_user
    password: ospo_password_change_me
    database: ospo_events
  service:
    port: 5432
  persistence:
    enabled: true
    size: 2Gi
    storageClass: ""  # Use default OpenShift storage class
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 512Mi
  securityContext:
    runAsUser: null
    runAsGroup: null
    fsGroup: null

# Keycloak configuration
keycloak:
  enabled: true
  publicUrl: "https://ospo-events-ospo-app-keycloak-prod-rh-events-org.apps.ospo-osci.z3b1.p1.openshiftapps.com/auth"
  image:
    repository: quay.io/keycloak/keycloak
    tag: 23.0.6
    pullPolicy: IfNotPresent
  admin:
    username: admin
    password: admin_change_me
  realm: ospo-events
  service:
    port: 8080
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  securityContext:
    runAsUser: null
    runAsGroup: null
    fsGroup: null

# MinIO configuration
minio:
  enabled: true
  image:
    repository: quay.io/minio/minio
    tag: RELEASE.2024-05-10T01-41-38Z
    pullPolicy: IfNotPresent
  auth:
    rootUser: minioadmin
    rootPassword: minioadmin_change_me
  service:
    apiPort: 9000
    consolePort: 9001
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi
  persistence:
    enabled: true
    size: 1Gi
    storageClass: ""  # Use default OpenShift storage class
  securityContext:
    runAsUser: null
    runAsGroup: null
    fsGroup: null

# Service Account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Shared volume configuration
sharedVolume:
  enabled: true
  persistentVolumeClaim:
    enabled: true
    name: ospo-uploads-pvc
    size: 1Gi
    storageClass: ""  # Use default OpenShift storage class
    accessMode: ReadWriteOnce

# Disable non-OpenShift features
loadBalancer:
  enabled: false

nodePort:
  enabled: false

ingress:
  enabled: false

# Optional: Enable monitoring if you have monitoring stack
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s

# Optional: Pod Disruption Budget for production
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Optional: Horizontal Pod Autoscaler
hpa:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80